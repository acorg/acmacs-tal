{   "_": "-*- js-indent-level: 4 -*-",

    "? overwrite in local settings": "----------------------------------------------------------------------",
    "tal": [
        {"?N": "nodes", "select": {"top-cumulative-gap": 2.0, "report": true}, "apply": {"?hide": true, "tree-edge-line-color": "red"}}
    ],

    "? for all antigenic maps": "",
    "antigenic-maps-all": [
        {"N": "legend", "show": false},
        "/no-labels"
    ],

    "? for specific antigenic map": "",
    "antigenic-map": [
        "antigenic-map-reset",
        {"N": "title", "remove-lines": true, "lines": ["{section_prefix}. {section_label} {section_aa_transitions:6}"]},
        {"N": "antigens", "select": {"in-section": true, "report": true}, "fill": {"time-series-color-scale": true}, "outline": "black", "size": 5, "order": "raise"},
        {"?N": "sera", "select": {"in-section": true, "report": true}, "fill": "red", "outline": "black", "size": 15, "order": "raise"}
    ],

    "antigenic-map-reset": [
        {"N": "border", "color": "black", "line_width": 0.5},
        {"N": "antigens", "select": "test",      "size": 3.0},
        {"N": "antigens", "select": "reference", "size": 5.0},
        {"N": "sera",     "select": "all",       "size": 5.0},
        {"N": "/all-color", "color": "grey88"},
        {"N": "antigens", "select": "reference", "order": "lower"},
        {"N": "sera",     "select": "all",       "order": "lower"},
        "/no-labels",
        {"N": "antigens", "select": {"in-tree": true, "report": false}, "fill": "gray63", "outline": "white", "outline_width": 0.5, "order": "raise"},
        {"N": "serum-circles-remove"}
    ],

    "init": [
        {"N": "set",
         "report-cumulative-output": "",
         "report-time-series-output": "",
         "whocc": false,
         "ladderize-method": "number-of-leaves",
         "tree-draw-aa-transitions": true,
         "virus-type/lineage": "XXX"
        }
    ],
    "? end overwrite in local settings": "----------------------------------------------------------------------",

    "tal-default": [
        "tal-pre",
        "layout",
        "tal-modifications"
    ],

    "? applied when chart is loaded": "",
    "/tal-mapi": [
        "mapi",
        {"N": "title", "show": true, "offset": [5, 5], "padding": 0, "remove-lines": true},
        "antigenic-maps-all"
    ],

    "layout": [
        {"N": "if", "condition": "{chart-present}",
         "then": [{"N": "layout-with-maps"}],
         "else": [{"N": "layout-tree-only"}]
        },
        {"?N": "vaccine, most recent cell --> modifications-tal mark vaccine"}
    ],

    "layout-tree-only": [
        {"N": "margins", "?left": 0.1, "?debug-outline": "cyan"},
        {"N": "tree", "color_by": "continent", "width-to-height-ratio": 0.48, "legend": {"show": true}, "debug-outline": false},
        {"N": "draw-on-tree"},
        {"?N": "gap", "width-to-height-ratio": 0.2, "debug-outline": {"color": "green", "width": 5}},
        "tal-dash-bar-clades",
        {"N": "time-series", "color_by": "continent", "color-scale": {"show": false}, "report": "{report-time-series-output}"},
        {"N": "clades"},
        {"N": "title", "text": "{virus-type/lineage}", "color": "black", "size": 0.015}
    ],

    "layout-with-maps": [
        {"N": "margins", "?left": 0.1, "?debug-outline": "cyan"},
        {"N": "tree", "color_by": "continent", "width-to-height-ratio": 0.48, "legend": {"show": true}, "debug-outline": false},
        {"N": "draw-on-tree"},
        "tal-dash-bar-clades",
        {"N": "clades"},
        {"N": "time-series", "color_by": "continent", "color-scale": {"show": true}, "report": "{report-time-series-output}"},
        {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"},
        {"N": "dash-bar", "nodes": [{"select": {"matches-chart-antigen": true}, "color": "#808080"}]},
        {"N": "hz-section-marker", "width-to-height-ratio": 0.005},
        {"N": "gap", "pixels": 20, "width-to-height-ratio": 0.0, "?debug-outline": "red"},
        {"N": "antigenic-maps"},
        {"N": "title", "text": "{virus-type/lineage} {chart-assay} {chart-lab}", "color": "black", "size": 0.015}
    ],

    "tal-modifications": [
        {"N": "if", "condition": "{tree-draw-aa-transitions}", "then": [
            {"N": "draw-aa-transitions",
             "minimum_number_leaves_in_subtree": 0.01,
             "text_line_interleave": 0.3,
             "all_nodes": {"label": {"scale": 0.01, "offset": [-0.04, 0.02], "tether": {"show": true, "color": "black", "line_width": 0.3}, "text_style": {"font": "monospace"}}}
            }
        ]},

        {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
            {"?N": "mark vaccine"},
            {"N": "nodes", "select": {"vaccine": {"type": "current", "passage": "cell"}, "report": false}, "apply": "report"}
        ]},

        {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
            "clades-whocc"
        ]},

        "tal"
    ],

    "tal-pre": [
        {"N": "if", "condition": {"and": ["{whocc}", {"not": "{tree-has-sequences}"}]}, "then": [
            {"N": "seqdb", "filename": "{seqdb-filename}"},
            {"N": "populate-with-nuc-duplicates"}
        ]},
        {"N": "report-cumulative", "output": "{report-cumulative-output}", "all": true},
        {"N": "ladderize", "method": "{ladderize-method}"},

        {"?N": ""}
    ],

    "tal-dash-bar-clades": [
        {"?N": "---------- H1 ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "A(H1N1)/Pdm"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "183P-1",   "color": "#a2b324", "label": {"text": "183P-1"}},
                 {"name": "183P-2",   "color": "#e72f27", "label": {"text": "183P-2"}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-3", "vertical_position": "top", "offset": [-0.002, 0.15]}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-6", "vertical_position": "bottom", "offset": [-0.002, -0.02]}},
                 {"name": "183P-4",   "color": "#742f32", "label": {"text": "183P-4", "vertical_position": "top"}},
                 {"name": "183P-5",   "color": "#e9a390", "label": {"text": "183P-5", "vertical_position": "top", "offset": [-0.002, 0.1]}},
                 {"name": "183P-5A",  "color": "#e9a390", "label": {"text": "183P-5A"}},
                 {"name": "183P-7",   "color": "#a020f0", "label": {"text": "183P-7", "vertical_position": "top"}}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]},

        {"?N": "---------- BVic ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "B/Vic"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "2DEL2017", "color": "#A0A0A0"},
                 {"name": "3DEL2017", "color": "#606060"}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]}
    ],

    "dash-bar-found-in-chart": [
        {"N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [
        ]}
    ],

    "clades-whocc": [
        "clades-{virus-type}{lineage}",
        {"N": "clades",
         "per_clade": [
             {"?N": "---------- H1 ----------"},
             {"name": "6B", "show": false},
             {"name": "6B1", "show": false},
             {"name": "6B1.A", "show": false},
             {"name": "6B2", "show": false},
             {"name": "183P", "show": false},
             {"name": "183P-1", "show": false},
             {"name": "183P-2", "show": false},
             {"name": "183P-3/6", "show": false},
             {"name": "183P-4", "show": false},
             {"name": "183P-5", "show": false},
             {"name": "183P-5A", "show": false},
             {"name": "183P-7", "show": false},
             {"?N": "---------- H3 ----------"},
             {"name": "3C.3", "show": false},
             {"name": "3C.2A", "show": false},
             {"name": "3C.2A1", "show": false, "section_inclusion_tolerance": 40},
             {"name": "3C.2A1A", "show": false, "section_exclusion_tolerance": 20},
             {"name": "3C.2A1B", "section_inclusion_tolerance": 40},
             {"name": "3C.2A4", "show": false},
             {"?N": "---------- BVic ----------"},
             {"name": "V1B", "show": false},
             {"name": "V1A", "section_inclusion_tolerance": 20},
             {"name": "2DEL2017", "show": false, "section_inclusion_tolerance": 15},
             {"name": "3DEL2017", "show": false},
             {"name": "6DEL2019", "show": false},
             {"?N": "---------- BYam ----------"},
             {"name": "Y2"},
             {"name": "Y3"},
             {"?N": ""}
         ],
         "?debug-outline": "lightblue"}
    ]
}
