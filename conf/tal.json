{"_": "-*- js-indent-level: 1 -*-",
 "init": [
  {"N": "set",
   "?report-cumulative-output": "",
   "?report-time-series-output": "",
   "whocc": false,
   "ladderize-method": "number-of-leaves"
  }
 ],
 "layout": [
  {"N": "margins", "?left": 0.1, "?debug_outline": "cyan"},
  {"N": "tree", "color_by": "continent", "width_to_height_ratio": 0.48, "debug_outline": false},
  {"?N": "gap", "width_to_height_ratio": 0.2, "debug_outline": {"color": "green", "width": 5}},

  {"N": "dash-bar-clades",
   "width_to_height_ratio": 0.009,
   "clades": [
    {"name": "2DEL2017", "color": "#A0A0A0"},
    {"name": "3DEL2017", "color": "#606060"}
   ],
   "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
   "?debug_outline": "lightblue"},
  {"N": "gap", "width_to_height_ratio": 0.005, "?debug_outline": "red"},

  {"N": "time_series", "color_by": "continent",
   "?start": "2019-01-01", "?end": "2019-12-31", "interval": {"month": 1},
   "?dash": {"width": 0.5, "line_width_pixels": 0.5}, "?": "dash width is a fraction of slot_width",
   "?slot": {"?separator": {"width_pixels": 2.5, "color": "red"},
            "?label": {"rotation": "anticlockwise", "color": "green3", "scale": 0.7, "offset": 0.002}, "?": "scale relative to slot_width, offset relative to the time series area height"
           },
   "?debug_outline": "lightblue"},

  {"N": "clades", "report": true,
   "slot": {"width": 0.02}, "?slot?": "width relative to the clades area height",
   "all_clades": {"?top_gap": 100.0, "?bottom_gap": 100.0,
                  "time_series_top_separator": true, "time_series_bottom_separator": true,
                  "section_inclusion_tolerance": 10, "section_exclusion_tolerance": 5,
                  "?label": {"?rotation_degrees": 45, "?color": "magenta", "scale": 0.7, "?position": "middle|top|bottom", "offset": [0.004, 0.0]}, "?label?": "scale relative to the slot width, offset relative to the area height",
                  "?arrow": {"color": "black", "line_width": 1, "arrow_width": 3.0}, "?arrow?": "line_width and arrow_width are in pixels",
                  "horizontal_line": {"color": "grey", "line_width": 0.5}, "?horizontal_line?": "width in pixels"
                 },
   "per_clade": [
    {"?N": " -- H1 ---"},
    {"?N": " -- H3 ---"},
    {"?N": " -- BVic ---"},
    {"name": "V1B", "show": false},
    {"name": "V1A", "section_inclusion_tolerance": 20},
    {"name": "2DEL2017", "show": false, "section_inclusion_tolerance": 15},
    {"name": "3DEL2017", "show": false},
    {"name": "6DEL2019", "show": false},
    {"?N": " -- BYam ---"},
   ],
   "?debug_outline": "lightblue"},

  {"N": "title", "display_name": "{virus-type/lineage}", "?offset": [0.3, -0.005], "color": "black", "size": 0.015},

  {"N": "legend", "?type": "world-map", "?offset": [0.0, 0.93], "?size": 0.15},

  {"?N": "hz lines"},
  {"?N": "H1 183P"},
  {"?N": "AA at pos"},
  {"?N": "AA substitutions"},
  {"?N": "vaccine, most recent cell"},
  {"?N": "legend", "type": "colored by AA at pos"},
  {"?N": "color bar for antigens colored by date"},
  {"?N": ""},

 ],
 "main": [
  {"N": "if", "condition": {"and": ["{whocc}", {"not": "{tree-has-sequences}"}]}, "then": [
   {"N": "seqdb", "filename": "{seqdb-filename}"}
  ]},
  {"N": "report-cumulative", "output": "{report-cumulative-output}", "all": true},
  {"N": "report-time-series", "output": "{report-time-series-output}"},
  {"N": "ladderize", "method": "{ladderize-method}"},
  {"?N": "update-common-aa", "report": false},
  {"N": "aa-transitions", "report": false},
  {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-antigen": true}, "apply": "report"}]},
  {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-serum": "name"}, "apply": "report"}]},

  {"?N": "nodes", "select": {"cumulative >=": 0.01, "report": false}, "apply": "hide"},
  {"?N": "nodes", "select": {"edge >=": 0.0173, "report": true}, "apply": {"hide": true, "tree-edge-line": "green", "?tree-edge-line-width": 5.0, "report": true}},
  {"N": "nodes", "select": {"edge >= mean_edge of": 0.005, "report": true}, "apply": {"hide": true, "tree-edge-line": "green", "?tree-edge-line-width": 5.0}},

  {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
   {"N": "clades-{virus-type}{lineage}", "report": false},
   {"N": "nodes", "select": {"vaccine": {"type": "current", "passage": "cell"}, "report": false}, "apply": "report"}
  ]},

  "layout"
 ]
}
