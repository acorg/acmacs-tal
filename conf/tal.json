{   "_": "-*- js-indent-level: 4 -*-",

    "? overwrite in local settings": "----------------------------------------------------------------------",
    "modifications": [
        {"?N": "nodes", "select": {"edge >= mean_edge of": 0.005, "report": true}, "apply": "hide"},
        "clades-whocc",
        {"?N": "tree", "color_by": {"N": "pos", "pos": 193}, "?width-to-height-ratio": 0.2, "?debug-outline": true},
        {"?N": "draw-aa-transitions", "per_node": []},
        {"?N": "time-series", "start": "2019-01-01", "?end": "2019-12-31", "?color_by": "continent"},
        {"?N": "title", "text": "{virus-type/lineage}", "?offset": [0.3, -0.005], "?color": "red"}
    ],

    "init": [
        {"N": "set",
         "?report-cumulative-output": "",
         "?report-time-series-output": "",
         "whocc": false,
         "ladderize-method": "number-of-leaves",
         "tree-draw-aa-transitions": true
        }
    ],
    "? end overwrite in local settings": "----------------------------------------------------------------------",

    "main": [
        "pre-tal",
        {"?N": "update-common-aa", "report": false},
        {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-antigen": true}, "apply": "report"}]},
        {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-serum": "name"}, "apply": "report"}]},

        "layout",
        "modifications-tal"
    ],

    "layout": [
        {"N": "margins", "?left": 0.1, "?debug-outline": "cyan"},
        {"N": "tree", "color_by": "continent", "width-to-height-ratio": 0.48, "debug-outline": false},
        {"N": "draw-on-tree"},
        {"?N": "gap", "width-to-height-ratio": 0.2, "debug-outline": {"color": "green", "width": 5}},
        "dash-bar-clades-tal",
        {"N": "time-series", "color_by": "continent"},
        {"N": "clades"},
        {"N": "title", "text": "{virus-type/lineage}", "color": "black", "size": 0.015},
        {"N": "legend", "?type": "world-map", "?offset": [0.0, 0.93], "?size": 0.15},

        {"?N": "hz lines"},
        {"?N": "vaccine, most recent cell --> modifications-tal mark vaccine"},
        {"?N": "legend", "type": "colored by AA at pos"},
        {"?N": "color bar for antigens colored by date"},
        {"?N": ""}
    ],

    "modifications-tal": [
        {"N": "if", "condition": "{tree-draw-aa-transitions}", "then": [
            {"N": "draw-aa-transitions",
             "minimum_number_leaves_in_subtree": 20,
             "text_line_interleave": 0.3,
             "all_nodes": {"label": {"scale": 0.01, "offset": [-0.04, 0.02], "tether": {"show": true, "color": "black", "line_width": 0.3}, "text_style": {"font": "monospace"}}}
            }
        ]},

        {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
            {"?N": "mark vaccine"},
            {"N": "nodes", "select": {"vaccine": {"type": "current", "passage": "cell"}, "report": false}, "apply": "report"}
        ]},

        "modifications",

        {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
            {"N": "clades-{virus-type}{lineage}", "report": false}
        ]}

    ],

    "pre-tal": [
        {"N": "if", "condition": {"and": ["{whocc}", {"not": "{tree-has-sequences}"}]}, "then": [
            {"N": "seqdb", "filename": "{seqdb-filename}"},
            {"N": "populate-with-nuc-duplicates"}
        ]},
        {"N": "report-cumulative", "output": "{report-cumulative-output}", "all": true},
        {"N": "report-time-series", "output": "{report-time-series-output}"},
        {"N": "ladderize", "method": "{ladderize-method}"},
        {"N": "if", "condition": "{tree-draw-aa-transitions}", "then": [
            {"N": "aa-transitions", "report": false}
        ]},

        {"?N": ""}
    ],

    "dash-bar-clades-tal": [
        {"?N": "---------- H1 ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "A(H1N1)/Pdm"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "183P-1",   "color": "#a2b324", "label": {"text": "183P-1"}},
                 {"name": "183P-2",   "color": "#e72f27", "label": {"text": "183P-2"}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-3", "vertical_position": "top", "offset": [-0.002, 0.15]}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-6", "vertical_position": "bottom", "offset": [-0.002, -0.02]}},
                 {"name": "183P-4",   "color": "#742f32", "label": {"text": "183P-4", "vertical_position": "top"}},
                 {"name": "183P-5",   "color": "#e9a390", "label": {"text": "183P-5", "vertical_position": "top", "offset": [-0.002, 0.1]}},
                 {"name": "183P-5A",  "color": "#e9a390", "label": {"text": "183P-5A"}},
                 {"name": "183P-7",   "color": "#a020f0", "label": {"text": "183P-7", "vertical_position": "top"}}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]},

        {"?N": "---------- BVic ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "B/Vic"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "2DEL2017", "color": "#A0A0A0"},
                 {"name": "3DEL2017", "color": "#606060"}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]}
    ],

    "clades-whocc": [
        {"N": "clades-per-clade",
         "per_clade": [
             {"?N": "---------- H1 ----------"},
             {"name": "6B", "show": false},
             {"name": "6B1", "show": false},
             {"name": "6B1.A", "show": false},
             {"name": "6B2", "show": false},
             {"name": "183P", "show": false},
             {"name": "183P-1", "show": false},
             {"name": "183P-2", "show": false},
             {"name": "183P-3/6", "show": false},
             {"name": "183P-4", "show": false},
             {"name": "183P-5", "show": false},
             {"name": "183P-5A", "show": false},
             {"name": "183P-7", "show": false},
             {"?N": "---------- H3 ----------"},
             {"name": "3C.3", "show": false},
             {"name": "3C.2A", "show": false},
             {"name": "3C.2A1", "show": false},
             {"name": "3C.2A1A", "section_exclusion_tolerance": 20},
             {"name": "3C.2A1B", "section_inclusion_tolerance": 20},
             {"?N": "---------- BVic ----------"},
             {"name": "V1B", "show": false},
             {"name": "V1A", "section_inclusion_tolerance": 20},
             {"name": "2DEL2017", "show": false, "section_inclusion_tolerance": 15},
             {"name": "3DEL2017", "show": false},
             {"name": "6DEL2019", "show": false},
             {"?N": "---------- BYam ----------"},
             {"name": "Y2"},
             {"name": "Y3"},
             {"?N": ""}
         ],
         "?debug-outline": "lightblue"}
    ]
}
