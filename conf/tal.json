{   "_": "-*- js-indent-level: 4 -*-",

    "? overwrite in local settings": "----------------------------------------------------------------------",
    "modifications": [
        {"?N": "tree", "color_by": {"N": "pos", "pos": 193}, "?width-to-height-ratio": 0.2, "?debug-outline": true},
        {"?N": "draw-aa-transitions", "per_node": []},
        {"?N": "time-series", "start": "2019-01-01", "?end": "2019-12-31", "?color_by": "continent"},
        {"?N": "title", "display_name": "{virus-type/lineage}", "?offset": [0.3, -0.005], "?color": "red"}
    ],

    "init": [
        {"N": "set",
         "?report-cumulative-output": "",
         "?report-time-series-output": "",
         "whocc": false,
         "ladderize-method": "number-of-leaves",
         "tree-draw-aa-transitions": true
        }
    ],
    "? end overwrite in local settings": "----------------------------------------------------------------------",

    "dash-bar-clades-tal": [
        {"?N": "---------- H1 ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "A(H1N1)/Pdm"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "183P-1",   "color": "#a2b324", "label": {"text": "183P-1"}},
                 {"name": "183P-2",   "color": "#e72f27", "label": {"text": "183P-2"}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-3", "vertical_position": "top", "offset": [-0.002, 0.15]}},
                 {"name": "183P-3/6", "color": "#03569b", "label": {"text": "183P-6", "vertical_position": "bottom", "offset": [-0.002, -0.02]}},
                 {"name": "183P-4",   "color": "#742f32", "label": {"text": "183P-4", "vertical_position": "top"}},
                 {"name": "183P-5",   "color": "#e9a390", "label": {"text": "183P-5", "vertical_position": "top", "offset": [-0.002, 0.1]}},
                 {"name": "183P-5A",  "color": "#e9a390", "label": {"text": "183P-5A"}},
                 {"name": "183P-7",   "color": "#a020f0", "label": {"text": "183P-7", "vertical_position": "top"}}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]},

        {"?N": "---------- BVic ----------"},
        {"N": "if", "condition": {"and": ["{whocc}", {"equal": ["{virus-type/lineage}", "B/Vic"]}]}, "then": [
            {"N": "dash-bar-clades",
             "width-to-height-ratio": 0.009,
             "clades": [
                 {"name": "2DEL2017", "color": "#A0A0A0"},
                 {"name": "3DEL2017", "color": "#606060"}
             ],
             "?dash": {"width": 1.0, "line_width_pixels": 0.5}, "?": "dash width is a fraction of area width",
             "?debug-outline": "lightblue"},
            {"N": "gap", "width-to-height-ratio": 0.005, "?debug-outline": "red"}
        ]}
    ],

    "clades-element": [
        {"N": "clades", "report": true,
         "slot": {"width": 0.02},
         "all_clades": {"?top_gap": 100.0, "?bottom_gap": 100.0,
                        "time_series_top_separator": true, "time_series_bottom_separator": true,
                        "section_inclusion_tolerance": 10, "section_exclusion_tolerance": 5,
                        "?label": {"?rotation_degrees": 45, "?color": "magenta", "scale": 0.7, "?vertical_position": "middle|top|bottom", "offset": [0.004, 0.0]},
                        "?arrow": {"color": "black", "line_width": 1, "arrow_width": 3.0}, "?arrow?": "line_width and arrow_width are in pixels",
                        "horizontal_line": {"color": "grey", "line_width": 0.5}, "?horizontal_line?": "width in pixels"
                       },
         "per_clade": [
             {"?N": "---------- H1 ----------"},
             {"name": "6B", "show": false},
             {"name": "6B1", "show": false},
             {"name": "6B1.A", "show": false},
             {"name": "6B2", "show": false},
             {"name": "183P", "show": false},
             {"name": "183P-1", "show": false},
             {"name": "183P-2", "show": false},
             {"name": "183P-3/6", "show": false},
             {"name": "183P-4", "show": false},
             {"name": "183P-5", "show": false},
             {"name": "183P-5A", "show": false},
             {"name": "183P-7", "show": false},
             {"?N": "---------- H3 ----------"},
             {"?N": "---------- BVic ----------"},
             {"name": "V1B", "show": false},
             {"name": "V1A", "section_inclusion_tolerance": 20},
             {"name": "2DEL2017", "show": false, "section_inclusion_tolerance": 15},
             {"name": "3DEL2017", "show": false},
             {"name": "6DEL2019", "show": false},
             {"?N": "---------- BYam ----------"}
         ],
         "?debug-outline": "lightblue"}
    ],

    "modifications-tal": [
        {"N": "if", "condition": "{tree-draw-aa-transitions}", "then": [
            {"N": "draw-aa-transitions",
             "minimum_number_leaves_in_subtree": 20,
             "text_line_interleave": 0.3,
             "all_nodes": {"label": {"scale": 0.01, "offset": [-0.04, 0.02], "tether": {"show": true, "color": "black", "line_width": 0.3}, "text_style": {"font": "monospace"}}}
            }
        ]},

        "modifications"

    ],

    "layout": [
        {"N": "margins", "?left": 0.1, "?debug-outline": "cyan"},
        {"N": "tree", "color_by": "continent", "width-to-height-ratio": 0.48, "debug-outline": false},
        {"?N": "gap", "width-to-height-ratio": 0.2, "debug-outline": {"color": "green", "width": 5}},
        "dash-bar-clades-tal",
        {"N": "time-series", "color_by": "continent"},

        {"N": "clades-element"},

        {"N": "title", "display_name": "{virus-type/lineage}", "color": "black", "size": 0.015},

        {"N": "legend", "?type": "world-map", "?offset": [0.0, 0.93], "?size": 0.15},

        {"?N": "hz lines"},
        {"?N": "AA at pos"},
        {"?N": "AA substitutions"},
        {"?N": "vaccine, most recent cell"},
        {"?N": "legend", "type": "colored by AA at pos"},
        {"?N": "color bar for antigens colored by date"},
        {"?N": ""}
    ],
    "?": "----------------------------------------------------------------------",
    "main": [
        {"N": "if", "condition": {"and": ["{whocc}", {"not": "{tree-has-sequences}"}]}, "then": [
            {"N": "seqdb", "filename": "{seqdb-filename}"}
        ]},
        {"N": "report-cumulative", "output": "{report-cumulative-output}", "all": true},
        {"N": "report-time-series", "output": "{report-time-series-output}"},
        {"N": "ladderize", "method": "{ladderize-method}"},
        {"?N": "update-common-aa", "report": false},
        {"N": "aa-transitions", "report": false},
        {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-antigen": true}, "apply": "report"}]},
        {"?N": "if", "condition": {"and": ["{whocc}", "{chart-present}"]}, "then": [{"N": "nodes", "select": {"matches-chart-serum": "name"}, "apply": "report"}]},

        {"?N": "nodes", "select": {"cumulative >=": 0.01, "report": false}, "apply": "hide"},
        {"?N": "nodes", "select": {"edge >=": 0.0173, "report": true}, "apply": {"hide": true, "tree-edge-line": "green", "?tree-edge-line-width": 5.0, "report": true}},
        {"N": "nodes", "select": {"edge >= mean_edge of": 0.005, "report": true}, "apply": {"hide": true, "tree-edge-line": "green", "?tree-edge-line-width": 5.0}},

        {"N": "if", "condition": {"and": ["{whocc}", {"not-empty": "{virus-type}"}]}, "then": [
            {"N": "clades-{virus-type}{lineage}", "report": false},
            {"N": "nodes", "select": {"vaccine": {"type": "current", "passage": "cell"}, "report": false}, "apply": "report"}
        ]},

        "layout",
        "modifications-tal"
    ]
}
